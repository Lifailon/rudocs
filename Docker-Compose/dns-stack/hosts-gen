while true; do
    echo "$BLACKLIST_URL >> $BLACKLIST_PATH"
    curl -sSL $BLACKLIST_URL -o $BLACKLIST_PATH
    sleep $BLACKLIST_UPDATE_TIMEOUT
done &

while true; do
    VIRTUAL_HOST_LIST=$(
        docker inspect $(docker ps -q) | jq -r '.[].Config.Env[]? | select(startswith("VIRTUAL_HOST=")) | sub("VIRTUAL_HOST=";"")'
    )
    rm -f $PROXY_HOSTS_PATH
    for VIRTUAL_HOST in ${VIRTUAL_HOST_LIST[@]}; do
        line="$PROXY_HOSTS_IP $VIRTUAL_HOST"
        echo "$line >> $PROXY_HOSTS_PATH"
        echo $line >> $PROXY_HOSTS_PATH
    done
    sleep $PROXY_UPDATE_TIMEOUT
done &

wait