input {
beats {
    port => 5044
  }
tcp   {
                type => "ESXi-vxrail"
                port => "1514"
                tags => ["VMware","ESXi-vxrail"]
  }

tcp {
                type => "FPS-vxrail"
                port => "1515"
                tags => ["VMware,FPS-vxrail"]
 }

tcp {
                type => "ESXi-vcenter"
                port => "2514"
                tags => ["VMware","ESXi-vcenter"]
        }

tcp {
                type => "FPS-vcenter"
                port => "2515"
                tags => ["VMware,FPS-vcenter"]
        }

tcp {
                type => "datadomain"
                port => "4514"
                tags => ["datadomain"]
        }
}

filter {
  mutate {
       remove_tag => [ "beats_input_codec_plain_applied" ]
      }
  if "info" in [message] { drop{ } }
  if "INFO" in [message] { drop{ } }


#  if "bitrix" in [tags] {
#    mutate {
#      add_field => { type => "bitrix" }
#      }
#    }


}

output {
     if [fields][class] == "winlog-security" {
      elasticsearch {
          hosts => ["http://10.50.10.84:9200"]
          user => "elastic"
          password => "6ncAZImH=yMdQvtBSsbZ"
          index => "winlog-security-%{+YYYY.MM.dd}"
      }
   }

#     else if ([type]=="ESXi-vcenter"){
#       elasticsearch {
#          index => "vmware_esxi_vcenter-%{+YYYY.MM.dd}"
#          user => "elastic"
#          password => "6ncAZImH=yMdQvtBSsbZ"
#          hosts => "srv-elastics-01:9200"
#       }
#   }


#     else if ([type]=="ESXi-vxrail"){
#      elasticsearch {
#         index => "vmware_esxi_vxrail-%{+YYYY.MM.dd}"
#         user => "elastic"
#         password => "6ncAZImH=yMdQvtBSsbZ"
#         hosts => "srv-elastics-01:9200"
#       }
#    }

     else if ([type]=="FPS-vxrail"){
      elasticsearch {
         index => "vmware_vcsa_vxrail-%{+YYYY.MM.dd}"
         user => "elastic"
         password => "6ncAZImH=yMdQvtBSsbZ"
         hosts => "srv-elastics-01:9200"
        }
     }

      else if ([type]=="FPS-vcenter"){
       elasticsearch {
          index => "vmware_vcsa_vcenter-%{+YYYY.MM.dd}"
          user => "elastic"
          password => "6ncAZImH=yMdQvtBSsbZ"
          hosts => "srv-elastics-01:9200"
        }
     }

      else if ([type]=="datadomain"){
       elasticsearch {
          index => "datadomain-%{+YYYY.MM.dd}"
          user => "elastic"
          password => "6ncAZImH=yMdQvtBSsbZ"
          hosts => "srv-elastics-01:9200"
        }
     }

      else if "bitrix" in [tags] {
       elasticsearch {
          index => "bitrix-%{+YYYY.MM.dd}"
          user => "elastic"
          password => "6ncAZImH=yMdQvtBSsbZ"
          hosts => "srv-elastics-01:9200"
        }
     }
     else if [fields][class] == "winlog-app" {
      elasticsearch {
          hosts => ["http://10.50.10.84:9200"]
          user => "elastic"
          password => "6ncAZImH=yMdQvtBSsbZ"
          index => "winlog-app-%{+YYYY.MM.dd}"
      }
   }

    else if [fields][class] == "winlog-system" {
      elasticsearch {
          hosts => ["http://10.50.10.84:9200"]
          user => "elastic"
          password => "6ncAZImH=yMdQvtBSsbZ"
          index => "winlog-system-%{+YYYY.MM.dd}"
      }
   }

    else if ([log][file][path] == "/var/log/syslog" or [log][file][path] == "/var/log/messages") {
       elasticsearch {
           hosts => ["http://10.50.10.84:9200"]
           user => "elastic"
           password => "6ncAZImH=yMdQvtBSsbZ"
           index => "linux-syslog-%{+YYYY.MM.dd}"
       }
   }
    else if ([log][file][path] == "/var/log/auth.log" or [log][file][path] == "/var/log/secure" or [log][file][path] == "/var/log/audit/audit.log") {
        elasticsearch {
            hosts => ["http://10.50.10.84:9200"]
            user => "elastic"
            password => "6ncAZImH=yMdQvtBSsbZ"
            index => "linux-auth-%{+YYYY.MM.dd}"
      }
     }
    else if [log][file][path] == "/var/log/sssd/sssd_etsp.ru.log" {
        elasticsearch {
            hosts => ["http://10.50.10.84:9200"]
            user => "elastic"
            password => "6ncAZImH=yMdQvtBSsbZ"
            index => "linux-auth-%{+YYYY.MM.dd}"
       }
     }

    else if [log][file][path] == "/var/log/logstash/logstash-plain.log" or [log][file][path] == "/var/log/kibana/kibana.log" {
        elasticsearch {
            hosts => ["http://10.50.10.84:9200"]
            user => "elastic"
            password => "6ncAZImH=yMdQvtBSsbZ"
            index => "elk-%{+YYYY.MM.dd}"
       }
     }
    else if [service][type] == "mssql" {
        elasticsearch {
            hosts => ["http://10.50.10.84:9200"]
            user => "elastic"
            password => "6ncAZImH=yMdQvtBSsbZ"
            index => "mssql-%{+YYYY.MM.dd}"
       }
     }

    else if [service][type] == "kafka" or [service][type] == "zookeeper" {
        elasticsearch {
            hosts => ["http://10.50.10.84:9200"]
            user => "elastic"
            password => "6ncAZImH=yMdQvtBSsbZ"
            index => "kafka-%{+YYYY.MM.dd}"
       }
     }

    else if [service][type] == "apache" {
        elasticsearch {
            hosts => ["http://10.50.10.84:9200"]
            user => "elastic"
            password => "6ncAZImH=yMdQvtBSsbZ"
            index => "apache-%{+YYYY.MM.dd}"
       }
     }
    else if [service][type] == "nginx" {
        elasticsearch {
            hosts => ["http://10.50.10.84:9200"]
            user => "elastic"
            password => "6ncAZImH=yMdQvtBSsbZ"
            index => "nginx-%{+YYYY.MM.dd}"
       }
     }
    else if [service][type] == "mysql" {
        elasticsearch {
            hosts => ["http://10.50.10.84:9200"]
            user => "elastic"
            password => "6ncAZImH=yMdQvtBSsbZ"
            index => "mysql-%{+YYYY.MM.dd}"
       }
     }
    else  {
      elasticsearch {
            hosts => ["http://10.50.10.84:9200"]
            user => "elastic"
            password => "6ncAZImH=yMdQvtBSsbZ"
            index => ["unknow_message"]
          }
       }
}
